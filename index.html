<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Radio Chile 24/7</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <button id="toggleTheme" style="position:fixed;top:10px;right:10px;padding:8px 12px;border:none;border-radius:5px;background:#0077cc;color:white;cursor:pointer;">
        Cambiar tema
    </button>

    <div class="container">
        <div class="ads left">Anuncio Lateral</div>

        <div class="main-radio">
            <canvas id="radioDial"></canvas>
            <h2 id="radioName">Radio Chile</h2>

            <audio id="radioPlayer" controls>
                Tu navegador no soporta audio.
            </audio>

            <button id="playRadio">â–¶ Reproducir Radio</button>
            <button id="changeRadio">ðŸ”„ Cambiar Radio</button>
        </div>

        <div class="chat-container">
            <h3>Chat en vivo</h3>
            <div id="chatBox"></div>
            <input type="text" id="chatInput" placeholder="Escribe un mensaje...">
            <button id="sendChat">Enviar</button>
        </div>

        <div class="ads bottom">Anuncio Inferior</div>
    </div>

    <!-- Inicializar Firebase -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-analytics.js";
      import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-auth.js";
      import { getDatabase, ref, push, onChildAdded } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-database.js";

      const firebaseConfig = {
        apiKey: "AIzaSyDTOjJGMavWosWKQAxi1LNDOWgdzpSv6-w",
        authDomain: "miradioweb-ab769.firebaseapp.com",
        databaseURL: "https://miradioweb-ab769-default-rtdb.firebaseio.com",
        projectId: "miradioweb-ab769",
        storageBucket: "miradioweb-ab769.firebasestorage.app",
        messagingSenderId: "763065724459",
        appId: "1:763065724459:web:acef207089498dca84846e",
        measurementId: "G-7H5PXZWCMY"
      };

      const app = initializeApp(firebaseConfig);
      const analytics = getAnalytics(app);
      const auth = getAuth();
      const database = getDatabase(app);

      signInAnonymously(auth).catch(console.error);

      window.firebaseRefs = { ref, push, onChildAdded, database, auth };
    </script>

    <!-- CÃ³digo de la radio y chat -->
    <script>
      // ===== Lista de radios =====
      const radios = [
          { name: "Radio Pudahuel", url: "https://envivo.pudahuel.cl/live.mp3" },
          { name: "Radio Imagina", url: "https://envivo.radioimagina.cl/live.mp3" },
          { name: "Radio ADN", url: "https://envivo.adnradio.cl/live.mp3" },
          { name: "Radio Bio Bio", url: "https://www.biobiochile.cl/media/audio/live.mp3" },
          { name: "Radio Cooperativa", url: "https://cooperativa.cl/media/audio/live.mp3" },
          { name: "Radio Futuro", url: "https://envivo.futuro.cl/live.mp3" },
          { name: "Radio Carolina", url: "https://carolina.cl/media/audio/live.mp3" },
          { name: "Radio CorazÃ³n", url: "https://envivo.corazon.cl/live.mp3" }
      ];

      // ===== Proxy CORS =====
      const corsProxy = "https://cors-anywhere.herokuapp.com/";

      // ===== Variables =====
      let currentIndex = 0;
      const player = document.getElementById("radioPlayer");
      const radioName = document.getElementById("radioName");

      // ===== FunciÃ³n para cambiar radio =====
      function changeRadio() {
          currentIndex = (currentIndex + 1) % radios.length;
          player.src = corsProxy + radios[currentIndex].url;
          radioName.textContent = radios[currentIndex].name;
      }

      // ===== FunciÃ³n para iniciar reproducciÃ³n =====
      function playRadio() {
          player.src = corsProxy + radios[currentIndex].url;
          player.play().catch(err => console.log("Error al reproducir:", err));
          radioName.textContent = radios[currentIndex].name;
      }

      // ===== Inicializar =====
      document.getElementById("playRadio").addEventListener("click", playRadio);
      document.getElementById("changeRadio").addEventListener("click", changeRadio);

      radioName.textContent = radios[0].name;

      // ===== CÃ³digo del chat con Firebase =====
      const chatBox = document.getElementById("chatBox");
      const chatInput = document.getElementById("chatInput");
      const sendChat = document.getElementById("sendChat");

      function initChat() {
          const { ref, push, onChildAdded, database } = window.firebaseRefs;

          sendChat.addEventListener("click", () => {
              if (chatInput.value.trim() !== "") {
                  push(ref(database, "messages"), {
                      user: "AnÃ³nimo",
                      text: chatInput.value,
                      timestamp: Date.now()
                  });
                  chatInput.value = "";
              }
          });

          chatInput.addEventListener("keypress", (e) => {
              if (e.key === "Enter") sendChat.click();
          });

          onChildAdded(ref(database, "messages"), (snapshot) => {
              const msg = snapshot.val();
              const div = document.createElement("div");
              div.textContent = `${msg.user}: ${msg.text}`;
              chatBox.appendChild(div);
              chatBox.scrollTop = chatBox.scrollHeight;
          });
      }

      setTimeout(initChat, 1000);

      const toggleTheme = document.getElementById("toggleTheme");
      toggleTheme.addEventListener("click", () => {
          document.body.classList.toggle("dark-theme");
      });
    </script>
</body>
</html>
